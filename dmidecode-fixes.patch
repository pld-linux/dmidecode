From 33b5aafc6ee6b5de9f2526fb1cf4b14d1e16e4f0 Mon Sep 17 00:00:00 2001
From: Roy Franz <roy.franz@linaro.org>
Date: Thu, 01 Oct 2015 06:41:43 +0000
Subject: Add "--no-sysfs" option description to -h output

A description of --no-sysfs was not added to the output of "-h" when
the feature was added, so add it now.
---
diff --git a/dmiopt.c b/dmiopt.c
index 0d142d2..de607f4 100644
--- a/dmiopt.c
+++ b/dmiopt.c
@@ -314,6 +314,7 @@ void print_help(void)
 		" -u, --dump             Do not decode the entries\n"
 		"     --dump-bin FILE    Dump the DMI data to a binary file\n"
 		"     --from-dump FILE   Read the DMI data from a binary file\n"
+		"     --no-sysfs         Do not attempt to read DMI data from sysfs files\n"
 		" -V, --version          Display the version and exit\n";
 
 	printf("%s", help);
--
cgit v0.9.0.2
From bf7bad24ce141dab5b5acc3ffb98ce5fe4a8e0f9 Mon Sep 17 00:00:00 2001
From: Xie XiuQi <xiexiuqi@huawei.com>
Date: Wed, 21 Oct 2015 13:12:50 +0000
Subject: Fix 'No SMBIOS nor DMI entry point found' on SMBIOS3

address_from_efi may return a SMBIOS or SMBIOS3 format entry
point, so add this condition.
---
diff --git a/AUTHORS b/AUTHORS
index d4badfa..ccf7fbb 100644
--- a/AUTHORS
+++ b/AUTHORS
@@ -19,6 +19,7 @@ Jarod Wilson <jarod@redhat.com>
 Anton Arapov <anton@redhat.com>
 Roy Franz <roy.franz@linaro.org>
 Tyler Bell <tyler.bell@hp.com>
+Xie XiuQi <xiexiuqi@huawei.com>
 
 MANY THANKS TO (IN CHRONOLOGICAL ORDER)
 Werner Heuser
diff --git a/dmidecode.c b/dmidecode.c
index ce0511b..cfcade4 100644
--- a/dmidecode.c
+++ b/dmidecode.c
@@ -4866,8 +4866,16 @@ int main(int argc, char * const argv[])
 		goto exit_free;
 	}
 
-	if (smbios_decode(buf, opt.devmem, 0))
-		found++;
+	if (memcmp(buf, "_SM3_", 5) == 0)
+	{
+		if (smbios3_decode(buf, opt.devmem, 0))
+			found++;
+	}
+	else if (memcmp(buf, "_SM_", 4) == 0)
+	{
+		if (smbios_decode(buf, opt.devmem, 0))
+			found++;
+	}
 	goto done;
 
 memory_scan:
--
cgit v0.9.0.2
